version: '3.8'

services:
  ecommerce-db:
    image: gvenzl/oracle-xe:21-slim-faststart
    container_name: ecommerce-db
    ports:
      - "1521:1521"
    environment:
      - ORACLE_PASSWORD=${ORACLE_PASSWORD}
    volumes:
      - oracle_data:/opt/oracle/oradata
    networks:
      - ecommerce-network
    healthcheck:
      test: [ "CMD-SHELL", "echo 'select 1 from dual;' | sqlplus -S system/${ORACLE_PASSWORD}@localhost:1521/XEPDB1" ]
      interval: 20s
      timeout: 15s
      retries: 10
      start_period: 40s

  ecommerce-product-service:
    build: ./product-service
    container_name: ecommerce-product-service
    ports:
      - "8081:8081"
    environment:
      - SPRING_DATASOURCE_URL=jdbc:oracle:thin:@ecommerce-db:1521/XEPDB1
      - SPRING_DATASOURCE_USERNAME=product
      - SPRING_DATASOURCE_PASSWORD=${ORACLE_PASSWORD}
    depends_on:
      ecommerce-db:
        condition: service_healthy
    networks:
      - ecommerce-network
#  frontend:
#    build: ./frontend
#    container_name: ecommerce-frontend
#    ports:
#      - "4200:80"
#    depends_on:
#      - ecommerce-product-service
#    networks:
#      - ecommerce-network


networks:
  ecommerce-network:
    driver: bridge

volumes:
  oracle_data: