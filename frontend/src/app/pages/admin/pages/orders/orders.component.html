<div class="relative p-6 rounded-2xl shadow bg-white">
  <!-- Header -->
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold text-gray-800">üì¶ Qu·∫£n l√Ω ƒë∆°n h√†ng</h1>
    <div class="flex gap-3">
      <button
        class="flex items-center bg-white text-blue-600 border border-blue-500 px-4 py-2 rounded-xl shadow-sm hover:bg-blue-50 transition"
      >
        <fa-icon [icon]="faFileExport"></fa-icon>
        <span class="ml-2 font-medium">Xu·∫•t t·ªáp</span>
      </button>
    </div>
  </div>

  <!-- Table -->
  <div class="overflow-x-auto border rounded-xl">
    <table class="table-auto text-left border-collapse bg-white rounded-t-xl w-full">
      <thead class="bg-gray-100 text-gray-600 text-sm uppercase tracking-wide">
      <tr>
        <th class="p-3 text-center">
          <input
            (change)="onCheckboxAll($event)"
            [checked]="selectionService.isAllSelected"
            class="w-4 h-4 accent-blue-500 cursor-pointer"
            type="checkbox"
          />
        </th>
        <th class="p-3">M√£ ƒë∆°n</th>
        <th class="p-3">Ng√†y ƒë·∫∑t</th>
        <th class="p-3">Kh√°ch h√†ng</th>
        <th class="p-3">Thanh to√°n</th>
        <th class="p-3">Tr·∫°ng th√°i</th>
        <th class="p-3">Ph∆∞∆°ng th·ª©c</th>
        <th class="p-3">T·ªïng ti·ªÅn</th>
        <th class="p-3 text-center">Thao t√°c</th>
      </tr>
      </thead>
      <tbody>
      <ng-container *ngIf="orders.length > 0; else noData">
        <tr
          *ngFor="let order of orders"
          class="border-b last:border-none hover:bg-gray-50 transition"
        >
          <!-- Checkbox -->
          <td class="p-3 text-center">
            <input
              (change)="onCheckbox(order.id, $event)"
              [checked]="selectionService.selectedItems.includes(order.id)"
              class="w-4 h-4 accent-blue-500 cursor-pointer"
              type="checkbox"
            />
          </td>

          <!-- M√£ ƒë∆°n -->
          <td class="p-3">
              <span class="inline-block bg-gray-100 text-gray-800 px-2 py-1 rounded text-xs font-mono">
                {{ order.orderCode }}
              </span>
          </td>

          <!-- Ng√†y -->
          <td class="p-3 text-gray-800 whitespace-nowrap">
            {{ order.formattedDate }}
          </td>

          <!-- Kh√°ch h√†ng -->
          <td class="p-3 text-gray-800 max-w-[200px] truncate">
            {{ order.customerName }}
          </td>

          <!-- Thanh to√°n -->
          <td class="p-3">
              <span
                [appStatus]="PaymentStatusMeta[order.paymentStatus]"
                class="inline-block px-2 py-1 rounded-full text-xs font-medium"
              ></span>
          </td>

          <!-- Tr·∫°ng th√°i -->
          <!-- C·ªôt Tr·∫°ng th√°i -->
          <td class="p-3">
            <div class="inline-flex items-center gap-2">
              <!-- Badge tr·∫°ng th√°i -->
              <span
                [appStatus]="OrderStatusMeta[order.orderStatus]"
                class="inline-block px-2 py-1 rounded-full text-xs font-medium"
              ></span>

              <!-- Dropdown ƒë·ªïi tr·∫°ng th√°i -->
              <select
                (ngModelChange)="updateOrderStatus(order, $event)"
                [ngModel]="order.orderStatus"
                class="border rounded-lg text-xs px-2 py-1 outline-none hover:border-blue-400 cursor-pointer"
              >
                <!-- tr·∫°ng th√°i hi·ªán t·∫°i (disabled) -->
                <option [ngValue]="order.orderStatus" disabled>
                  {{ OrderStatusMeta[order.orderStatus].label }}
                </option>

                <!-- ch·ªâ show tr·∫°ng th√°i ƒë∆∞·ª£c ph√©p -->
                <ng-container *ngFor="let status of getAllowedNextStatuses(order.orderStatus)">
                  <option [ngValue]="status">
                    {{ OrderStatusMeta[status].label }}
                  </option>
                </ng-container>
              </select>
            </div>
          </td>


          <!-- Ph∆∞∆°ng th·ª©c -->
          <td class="p-3 text-gray-700">
            {{ order.paymentMethod }}
          </td>

          <!-- T·ªïng ti·ªÅn -->
          <td class="p-3 text-gray-800 font-semibold ">
            {{ order.orderAmount | currency: 'VND':'symbol':'1.0-0' }}
          </td>

          <!-- Actions -->
          <td class="p-3 text-center">
            <div class="flex justify-center gap-2">
              <button
                (click)="confirmOrder(order)"
                *ngIf="canChangeTo(order.orderStatus, OrderStatus.confirmed)"
                class="p-2 text-green-600 rounded-full hover:bg-green-50"
                title="X√°c nh·∫≠n ƒë∆°n"
              >
                <fa-icon [icon]="faClipboardCheck"></fa-icon>
              </button>

              <button
                (click)="shipOrder(order)"
                *ngIf="canChangeTo(order.orderStatus, OrderStatus.shipping)"
                class="p-2 text-blue-600 rounded-full hover:bg-blue-50"
                title="B·∫Øt ƒë·∫ßu giao h√†ng"
              >
                <fa-icon [icon]="faTruck"></fa-icon>
              </button>

              <button
                (click)="confirmPaid(order)"
                *ngIf="order.paymentMethod === PaymentMethodStatus.COD
             && order.paymentStatus === PaymentStatus.Pending"
                class="flex items-center text-blue-600 hover:text-blue-800 transition"
                title="X√°c nh·∫≠n ƒë√£ thanh to√°n"
              >
                <fa-icon [icon]="faMoneyBillWave"></fa-icon>
              </button>
            </div>
          </td>
        </tr>
      </ng-container>

      <!-- No data -->
      <ng-template #noData>
        <tr>
          <td class="text-center text-gray-500 py-6" colspan="9">
            Kh√¥ng c√≥ ƒë∆°n h√†ng n√†o
          </td>
        </tr>
      </ng-template>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="p-4 border-t">
    <app-page
      (pageChange)="loadOrders($event.page)"
      (pageSizeChange)="onPageSizeChange($event)"
      [currentPage]="currentPage"
      [pageSize]="pageSize"
      [pageSizes]="pageSizes"
      [totalItems]="totalItems"
    ></app-page>
  </div>
</div>
